{% extends 'base.html' %}

{% load static %}
{% block extra_head %}

  <!-- leflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
  integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
  crossorigin=""/>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
  integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
  crossorigin=""></script>

  <link rel="stylesheet" href="{% static '/dist/MarkerCluster.css' %}" />
  <link rel="stylesheet" href="{% static '/dist/MarkerCluster.Default.css' %}" />

  <style>
      .button_container{
          display: flex;
          margin-bottom: 2rem;
          margin-top: 1rem;
          align-items: center;
      }

      .button_container .select{
          margin-left: 0.5rem;
          padding: 5px;
          border: 1px solid #fb4e2e;
          background: #fff;
          color: black;
          font-size: 18px;
          font-weight: 400;
          cursor: pointer;
          width: 150px;
      }

      .button_container button{
          padding: 5px;
          font-size: 18px;
          color: #fb4e2e;
          border: 1px solid hsl(9, 96%, 58%);
          background: #fff;
          margin-left: 5px;
          width: 150px;
          cursor: pointer;
      }

      .button_container button:hover{
          background: #fb4e2e;
          color: #fff;
          letter-spacing: 2px;
      }
  </style>

  <style>
      .box-icon{
        width: 30rem;
        border:.1rem solid rgba(0,0,0,.1);
        box-shadow: 0 .5rem 1rem rgba(0,0,0,.1);
        border-radius: .5rem;
        overflow:hidden;
        background:rgba(0,0,0,.1);
        align-items: center;


        
      }
      .box-icon:hover .image-container-icon img{
            transform: scale(1.1);
        }

    .box-icon .image-container-icon{
        overflow:hidden;
        position: relative;
        width: 100%;
        height: 25rem;

    }
    .box-icon .image-container-icon  img{
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: .2s linear;
    }

    .box-icon .image-container-icon .info{
        position: absolute;
        top:1rem; left:0;
        display: flex;
    }

    .box-icon .image-container-icon .info h3{
        font-weight: 500;
        font-size: 1.4rem;
        color:#fff;
        background:rgba(0,0,0,.3);
        border-radius: .5rem;
        padding:.5rem 1.5rem;
        margin-left: 1rem;
    }

    .box-icon .image-container-icon .icons{
        position: absolute;
        bottom:1rem; right:0;
        display: flex;
    }

    .box-icon .image-container-icon .icons a{
        font-size: 1.4rem;
        color:#fff;
        display: flex;
        border-radius: .5rem;
        background: rgba(0,0,0,.3);
        margin-right: 1rem;
        padding:.7rem;
}

.box-icon .image-container-icon .icons a:hover{
    background:#fb4e2e;
}

.box-icon .image-container-icon .icons a  h3{
    font-weight: 500;
    padding-left: .5rem;
}

.box-icon .content{
    padding:1.5rem;
    
}

.box-icon .content .price{
    display: flex;
    align-items: center;
}

.box-icon .content .price h3{
        color:#fb4e2e;
        font-size: 2rem;
        margin-right: auto;
        background: #fff;
    }

    .box-icon .content .price a{
        color:#666;
        font-size: 1.5rem;
        margin-right: .5rem;
        border-radius: .5rem;
        height:4rem;
        width:4rem;
        line-height: 4rem;
        text-align: center;
        background:#f7f7f7;
    }

    .box-icon .content .price a:hover{
        background:#fb4e2e;
        color:#fff;
    }

    .box-icon .content .location{
        padding:1rem 0;
    
    }

    .box-icon .content .location h3{
        font-size: 2.5rem;
        color:#333;
    }

    .box-icon .content .location  p{
        font-size: 1.5rem;
        color:#666;
        line-height: 1.5;
        padding-top: .5rem;
    }

  </style>



{% endblock extra_head %}

{% block content %}

   

<!-- breadbrump -->
<section class="breadbrump">
    <div>
       <div >
          <h1 class="page-title">Map View</h1>
          <div>
             <ul>
                <li><a href="#/"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="#/"><i class="fas fa-angle-double-right"></i> map view </a></li>
             </ul>
          </div>
       </div>
    </div>
    </div>
  </section>
  
<!-- endbread brump -->


<section class="map" id="contact">

    
  
    {% if formatted %}
    <p style="font-size:2rem;color:black; margin-bottom:2rem;"> search near : {{formatted}} </p>
    {% endif %}

    <div class="button_container">

        <select class="select" name="price" id="price">
            <option value="volvo">Volvo</option>
            <option value="saab">Saab</option>
            <option value="mercedes">Mercedes</option>
            <option value="audi">Audi</option>
          </select>

          <select class="select" name="beds" id="beds">
            <option value="volvo">Volvo</option>
            <option value="saab">Saab</option>
            <option value="mercedes">Mercedes</option>
            <option value="audi">Audi</option>
          </select>

        <button type="button"> Save </button>


    </div>

    
    
    <div class="row">
    
        
        <div class="list-property">
            <div class="box-container" id="card-container">

         
           
            </div>
    
        </div>
    
        <div id="map"></div>
    </div>
    
    </section>


<!-- footer section starts  -->



{% endblock content %}


{% block extra_js %}

<!-- markercluster  -->
<script src="{% static '/dist/leaflet.markercluster.js' %}"></script>


<script>

    // map
    var map = L.map( 'map', {
        center: [-1.286389, 36.817223],
        minZoom: 2,
        zoom: 5,
        zoomControl: true
    
        });
    L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}',{
        maxZoom: 20,
        subdomains:['mt0','mt1','mt2','mt3']
    }).addTo(map);

  

     var smallIcon = new L.Icon({
        iconSize: [27, 27],
        iconAnchor: [13, 27],
        popupAnchor:  [1, -24],
        iconUrl: '{% static "images/mk.png" %}'
    });
    
     const markers = L.markerClusterGroup();

    
    $.getJSON("{% url 'homepage:get_all_data' %}", function(data){
        
        var geojson = L.geoJson(data, {
        onEachFeature: function(feature, layer) {
             // create popup contents

             console.log(feature.properties.account_number)
             var customPopup = `
                    <div id="box" class="box-icon">
                    <div style="cursor:pointer;" id="image_cont" class="image-container-icon">
                        <img src="${feature.properties.building_main_pic}" alt="">
                              <div class="info">
                           
                            <h3>for rent</h3>
                        </div>
                      
                    </div>
                    <div class="content">
                        <div class="price">
                            
                            <a href="#" class="fas fa-heart"></a>
                            <a href="#" class="fas fa-envelope"></a>
                            <a href="#" class="fas fa-phone"></a>
                        </div>
                        <div class="location">
                            <h3>${feature.properties.building_name}</h3>
                            <p>${feature.properties.location_name}</p>
                        </div>
                       
                        <div class="buttons">
                            <a href="#" class="btn">request info</a>
                            <a href="/map_detailed/${feature.id}/" class="btn">view details</a>
                        </div>
                    </div>
                </div>
                `
                ;
    
            layer.bindPopup( customPopup);
        },
        pointToLayer: function (feature, latlng) {
            return markers.addLayer(L.marker(latlng, {icon: smallIcon}).on('mouseover',(e)=>{
                console.log(latlng)
                var element = `
                    <div id="box" class="box">
                    <div style="cursor:pointer;" id="image_cont" class="image-container">
                        <img src="${feature.properties.building_main_pic}" alt="">
                              <div class="info">
                           
                            <h3>for rent</h3>
                        </div>
                      
                    </div>
                    <div class="content">
                        <div class="price">
                            
                            <a href="#" class="fas fa-heart"></a>
                            <a href="#" class="fas fa-envelope"></a>
                            <a href="#" class="fas fa-phone"></a>
                        </div>
                        <div class="location">
                            <h3>${feature.properties.building_name}</h3>
                            <p>${feature.properties.location_name}</p>
                        </div>
                       
                        <div class="buttons">
                            <a href="#" class="btn">request info</a>
                            <a href="/map_detailed/${feature.id}/" class="btn">view details</a>
                        </div>
                    </div>
                </div>
                `
                
                var card_container  =  $('#card-container')
                card_container.empty();
                card_container.append(element)



            }));
          }
     });
     geojson.addTo(map);
     
     });
     // marker clustering
    map.addLayer(markers);



</script>


<script>

    var card_container  =  $('#card-container')

    $.ajax({
        type: 'GET',
        url: "{% url 'homepage:get_all_data' %}",
        success: function (response) {
            // on successfull creating object
             // 1. clear the form.
            var dataa = response.features

            for (let j = 0; j < dataa.length; j++) {
                var building = dataa[j];
                console.log(building)
               
                    
                    var element = `
                    <div id="box" class="box">
                    <div style="cursor:pointer;" id="image_cont" class="image-container">
                        <img src="${building.properties.building_main_pic}" alt="">
                              <div class="info">
                           
                            <h3>for rent</h3>
                        </div>
                      
                    </div>
                    <div class="content">
                        <div class="price">
                            
                            <a href="#" class="fas fa-heart"></a>
                            <a href="#" class="fas fa-envelope"></a>
                            <a href="#" class="fas fa-phone"></a>
                        </div>
                        <div class="location">
                            <h3>${building.properties.building_name}</h3>
                            <p>${building.properties.location_name}</p>
                        </div>
                       
                        <div class="buttons">
                            <a href="#" class="btn">request info</a>
                            <a href="/map_detailed/${building.id}/" class="btn">view details</a>
                        </div>
                    </div>
                </div>
                `
                
                card_container.append(element)

                

                
                

                //card_container.append(element)
              }

            
            // display the newly friend to table.
            // var instance = JSON.parse(response);


          
           
            

          
          
        },
        error: function (response) {
            // alert the error if any error occured
            alert(response["responseJSON"]["error"]);
        }
    })

</script>


<script>
    const selectedd =    $("#myselect :selected").text();


</script>


{% endblock extra_js %}

